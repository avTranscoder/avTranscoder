import glob, re
import os

Import( "env" )
Import( "envJava" )
Import( "envPy" )
Import( "installPrefix" )
Import( "resampleLibraryName" )

AvTranscoderVersion = "0.0.1"

env.Append(
    SHLIBVERSION = AvTranscoderVersion
)

sAvTranscoder = env.StaticLibrary(
    'sAvTranscoder',
    Glob( 'AvTranscoder/*.cpp' ) +
    Glob( 'AvTranscoder/DatasStructures/*.cpp' ) +
    Glob( 'AvTranscoder/File/*.cpp' ),
    LIBS = [
        'avutil',
        'avcodec',
        'avformat',
        'swscale',
        resampleLibraryName,
    ]
)

SharedAvTranscoder = env.SharedLibrary(
    'AvTranscoder',
    Glob( 'AvTranscoder/*.cpp' ) +
    Glob( 'AvTranscoder/DatasStructures/*.cpp' ) +
    Glob( 'AvTranscoder/File/*.cpp' ),
    LIBS = [
        'avutil',
        'avcodec',
        'avformat',
        'swscale',
        resampleLibraryName,
    ],
    SHLIBVERSION = AvTranscoderVersion,
)

jAvTranscoder = envJava.SharedLibrary(
        'jAvTranscoder',
        source=['AvTranscoder/avTranscoder.i'],
        LIBS=[ 
            sAvTranscoder,
            'avutil',
            'avcodec',
            'avformat',
            'swscale',
            resampleLibraryName,
        ],
    )

pyAvTranscoder = envPy.SharedLibrary(
        'pyAvTranscoder',
        source='AvTranscoder/avTranscoder.i',
        LIBS=[
            sAvTranscoder,
            'avutil',
            'avcodec',
            'avformat',
            'swscale',
            resampleLibraryName,
        ],
    )

# avTranscoder_class = env.Java(
#       target='AvTranscoderClass',
#       source= Glob( envJava['JARCHDIR'] ) )

# avTranscoder_jar = env.Jar(
#     target='jAvTranscoder.jar',
#     source=avTranscoder_class )
    #source= Glob( '#build/src/AvTranscoderClass' ) )


# env.Depends( avTranscoder_class, jAvTranscoder )
# env.Depends( avTranscoder_jar, avTranscoder_class )

Export( { 'sAvTranscoder' : sAvTranscoder } )
Export( { 'AvTranscoder'  : 'AvTranscoder' } )
# Export( { 'AvTranscoder_jar': avTranscoder_class } )

installSharedLib = env.InstallVersionedLib( os.path.join( installPrefix, "lib" ), SharedAvTranscoder)

env.Alias( "install", env.Install(os.path.join( installPrefix, "lib" ), sAvTranscoder ) )
env.Alias( "install", installSharedLib )
env.Alias( "install", env.Install(os.path.join( installPrefix, "lib" ), jAvTranscoder ) )

env.Alias( "install", env.Install(os.path.join( installPrefix, "include/AvTranscoder" ), Glob( 'AvTranscoder/*.hpp' ) ) )
env.Alias( "install", env.Install(os.path.join( installPrefix, "include/AvTranscoder/Metadatas" ), Glob( 'AvTranscoder/Metadatas/MediaMetadatasStructures.hpp' ) ) )
env.Alias( "install", env.Install(os.path.join( installPrefix, "include/AvTranscoder/DatasStructures" ), Glob( 'AvTranscoder/DatasStructures/*.hpp' ) ) )
